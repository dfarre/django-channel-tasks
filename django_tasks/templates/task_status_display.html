<script>
    var admin_ws = admin_ws || new WebSocket('ws://' + window.location.host + '/tasks/');

    admin_ws.onopen = function (event) {
        console.log('WebSocket connection opened at /tasks/');
    };

    admin_ws.onclose = function (event) {
        console.log('WebSocket connection at /tasks/ closed.');
    };

    admin_ws.onerror = function (event) {
        console.error('WebSocket error at /tasks/:', event);
    };

    admin_ws.onmessage = function (msg_event) {
        console.log('WebSocket message received: ' + msg_event.data);
        const msg = JSON.parse(msg_event.data);
        const group = msg.type.split('.')[0];
        if (group == 'task') {
            const status_element_id = 'task-msg-' + String(msg.content.pk);
            const status_element = document.getElementById(status_element_id);
            if (status_element) {
                status_element.innerHTML = JSON.stringify(msg.content);
            } else {
                console.log('Element ' + status_element_id + ' not found');
            }
        }
    }
</script>
{% extends "admin/change_list.html" %}
